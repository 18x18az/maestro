// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model GenericEphemeral {
  key   String @unique
  value String
}

model GenericPersistent {
  key   String @unique
  value String
}

model Display {
  uuid    String       @unique
  field   Field? @relation(fields: [fieldId], references: [id])
  fieldId Int?
  name    String
}

model Field {
  id       Int                 @id @unique @default(autoincrement())
  name     String
  displays Display[]
  matches  ScheduledMatch[]
  isCompetition Int
  isEnabled Int
}

model Block {
  id               Int                 @id @unique @default(autoincrement())
  status           String              @default("NOT_STARTED")
  scheduledMatches ScheduledMatch[]
}

model Match {
  id        Int                 @id @unique @default(autoincrement())
  round     String
  number    Int
  sitting   Int
  red1      String
  red2      String
  blue1     String
  blue2     String
  scheduled ScheduledMatch[]

  @@unique([round, number, sitting])
}

model ScheduledMatch {
  id      Int         @id @unique @default(autoincrement())
  block   Block @relation(fields: [blockId], references: [id])
  blockId Int
  replay  Int         @default(0)
  match   Match @relation(fields: [matchId], references: [id])
  matchId Int
  field   Field @relation(fields: [fieldId], references: [id])
  fieldId Int
  time    String?
  status String

  @@unique([matchId, replay])
}
