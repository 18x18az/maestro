generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model GenericEphemeral {
  key   String @unique
  value String
}

model GenericPersistent {
  key   String @unique
  value String
}

model Display {
  uuid    String @unique
  fieldId Int?
  name    String
  field   Field? @relation(fields: [fieldId], references: [id])
}

model Field {
  id            Int              @id @unique @default(autoincrement())
  name          String
  isCompetition Int
  isEnabled     Int
  displays      Display[]
  matches       ScheduledMatch[]
  scene         Scene?
}

model Block {
  id               Int              @id @unique @default(autoincrement())
  status           String           @default("NOT_STARTED")
  scheduledMatches ScheduledMatch[]
}

model Match {
  id        Int              @id @unique @default(autoincrement())
  round     String
  number    Int
  sitting   Int
  red1      String
  red2      String
  blue1     String
  blue2     String
  scheduled ScheduledMatch[]

  @@unique([round, number, sitting])
}

model ScheduledMatch {
  id      Int     @id @unique @default(autoincrement())
  blockId Int
  replay  Int     @default(0)
  matchId Int
  fieldId Int
  time    String?
  status  String
  field   Field   @relation(fields: [fieldId], references: [id])
  match   Match   @relation(fields: [matchId], references: [id])
  block   Block   @relation(fields: [blockId], references: [id])

  @@unique([matchId, replay])
}

model Scene {
  id Int @id @unique @default(autoincrement())
  field Field? @relation(fields: [fieldId], references: [id])
  fieldId Int @unique
  camera Camera?
}

model Camera {
  id Int @id @unique @default(autoincrement())
  address String @unique
  scene Scene @relation(fields: [sceneId], references: [id])
  sceneId Int @unique
}
